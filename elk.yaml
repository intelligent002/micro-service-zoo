services:

    # Logstash Service
    zoo-elk-ls:
        image: docker.elastic.co/logstash/logstash:7.17.10
        container_name: zoo-elk-ls
        restart: unless-stopped
        ports:
            - "5044:5044"  # For Beats input
            - "5000:5000/tcp" # For Logstash TCP input
            - "5000:5000/udp" # For Logstash UDP input
        environment:
            LS_JAVA_OPTS: "-Xmx512m -Xms512m"
        depends_on:
            - zoo-elk-es
        volumes:
            - ./zoo-elk-ls/pipeline/:/usr/share/logstash/pipeline/
        networks:
            - zoo

    # Elasticsearch Service
    zoo-elk-es:
        image: docker.elastic.co/elasticsearch/elasticsearch:7.17.10
        container_name: zoo-elk-es
        restart: unless-stopped
        environment:
            - discovery.type=single-node
            - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"
        healthcheck:
            test: ["CMD-SHELL", "curl -f http://zoo-elk-es:9200 || exit 1"]
            interval: 30s
            retries: 5
            start_period: 60s
            timeout: 10s
        ports:
            - "9200:9200"
        volumes:
            - es-data:/usr/share/elasticsearch/data
        networks:
            - zoo

    # Kibana Service
    zoo-elk-kb:
        image: docker.elastic.co/kibana/kibana:7.17.10
        container_name: zoo-elk-kb
        restart: unless-stopped
        environment:
            - ELASTICSEARCH_HOSTS=http://zoo-elk-es:9200
        depends_on:
            - zoo-elk-es
        ports:
            - "5601:5601"
        networks:
            - zoo

# Named volumes for persistent data storage
volumes:
    es-data:

# Shared network between the containers
networks:
    zoo:
        driver: bridge
