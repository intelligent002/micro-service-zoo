{
  "dashboard": {
    "id": null,
    "title": "cAdvisor Metrics Dashboard",
    "tags": ["cAdvisor", "Docker", "Containers"],
    "timezone": "browser",
    "schemaVersion": 27,
    "version": 0,
    "refresh": "5s",
    "templating": {
      "list": [
        {
          "type": "query",
          "datasource": "Prometheus",
          "name": "container_name",
          "label": "Container Name",
          "query": "label_values(container_name)",
          "refresh": 1
        },
        {
          "type": "query",
          "datasource": "Prometheus",
          "name": "instance",
          "label": "Instance",
          "query": "label_values(instance)",
          "refresh": 1
        }
      ]
    },
    "panels": [
      {
        "title": "Container Uptime",
        "type": "stat",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "time() - container_start_time_seconds{container_name=~\"$container_name\", instance=~\"$instance\"}",
            "legendFormat": "{{container_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "s",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": null }
              ]
            }
          }
        }
      },
      {
        "title": "CPU Usage (Percentage)",
        "type": "graph",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "rate(container_cpu_usage_seconds_total{container_name=~\"$container_name\", instance=~\"$instance\"}[5m]) * 100",
            "legendFormat": "{{container_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": null },
                { "color": "orange", "value": 80 },
                { "color": "red", "value": 90 }
              ]
            }
          }
        }
      },
      {
        "title": "Memory Usage",
        "type": "gauge",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "container_memory_usage_bytes{container_name=~\"$container_name\", instance=~\"$instance\"}",
            "legendFormat": "{{container_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "bytes",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": null },
                { "color": "orange", "value": 536870912 },
                { "color": "red", "value": 1073741824 }
              ]
            }
          }
        }
      },
      {
        "title": "CPU Throttling",
        "type": "graph",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "rate(container_cpu_cfs_throttled_seconds_total{container_name=~\"$container_name\", instance=~\"$instance\"}[5m])",
            "legendFormat": "{{container_name}}",
            "refId": "A"
          }
        ]
      },
      {
        "title": "Memory RSS vs Cache",
        "type": "barchart",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "container_memory_rss{container_name=~\"$container_name\", instance=~\"$instance\"}",
            "legendFormat": "RSS",
            "refId": "A"
          },
          {
            "expr": "container_memory_cache{container_name=~\"$container_name\", instance=~\"$instance\"}",
            "legendFormat": "Cache",
            "refId": "B"
          }
        ]
      },
      {
        "title": "Filesystem Usage",
        "type": "gauge",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "container_fs_usage_bytes{container_name=~\"$container_name\", instance=~\"$instance\"} / container_fs_limit_bytes{container_name=~\"$container_name\", instance=~\"$instance\"}",
            "legendFormat": "{{container_name}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": null },
                { "color": "orange", "value": 70 },
                { "color": "red", "value": 90 }
              ]
            }
          }
        }
      },
      {
        "title": "Disk I/O",
        "type": "graph",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "rate(container_blkio_io_service_bytes_total{container_name=~\"$container_name\", instance=~\"$instance\", operation=\"Read\"}[5m])",
            "legendFormat": "Read",
            "refId": "A"
          },
          {
            "expr": "rate(container_blkio_io_service_bytes_total{container_name=~\"$container_name\", instance=~\"$instance\", operation=\"Write\"}[5m])",
            "legendFormat": "Write",
            "refId": "B"
          }
        ]
      },
      {
        "title": "Network Traffic",
        "type": "graph",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "rate(container_network_receive_bytes_total{container_name=~\"$container_name\", instance=~\"$instance\"}[5m])",
            "legendFormat": "Receive",
            "refId": "A"
          },
          {
            "expr": "rate(container_network_transmit_bytes_total{container_name=~\"$container_name\", instance=~\"$instance\"}[5m])",
            "legendFormat": "Transmit",
            "refId": "B"
          }
        ]
      },
      {
        "title": "Network Errors",
        "type": "stat",
        "datasource": "Prometheus",
        "targets": [
          {
            "expr": "sum(rate(container_network_receive_errors_total{container_name=~\"$container_name\", instance=~\"$instance\"}[5m])) + sum(rate(container_network_transmit_errors_total{container_name=~\"$container_name\", instance=~\"$instance\"}[5m]))",
            "legendFormat": "Errors",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "color": "green", "value": 0 },
                { "color": "red", "value": 1 }
              ]
            }
          }
        }
      }
    ]
  }
}
